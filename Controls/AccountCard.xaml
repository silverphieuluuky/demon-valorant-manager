<UserControl x:Class="RiotAutoLogin.Controls.AccountCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:conv="clr-namespace:RiotAutoLogin.Converters"
             xmlns:effects="clr-namespace:System.Windows.Media.Effects;assembly=PresentationCore"
             mc:Ignorable="d" 
             d:DesignHeight="320" d:DesignWidth="220">
    
    <UserControl.Resources>
        <!-- Hover Animation -->
        <Storyboard x:Key="HoverAnimation">
            <DoubleAnimation Storyboard.TargetName="CardBorder"
                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                           To="1.02" Duration="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="CardBorder"
                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                           To="1.02" Duration="0:0:0.2"/>
        </Storyboard>
        
        <!-- Click Animation -->
        <Storyboard x:Key="ClickAnimation">
            <DoubleAnimation Storyboard.TargetName="CardBorder"
                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                           To="0.98" Duration="0:0:0.1" AutoReverse="True"/>
            <DoubleAnimation Storyboard.TargetName="CardBorder"
                           Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                           To="0.98" Duration="0:0:0.1" AutoReverse="True"/>
        </Storyboard>
        
        <!-- Loading Animation -->
        <Storyboard x:Key="LoadingAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="LoadingRing"
                           Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                           From="0" To="360" Duration="0:0:1"/>
        </Storyboard>
        
        <!-- Converters -->
        <conv:StringToImageSourceConverter x:Key="StringToImageSourceConverter"/>
        <conv:RankToIconConverter x:Key="RankToIconConverter"/>
        <conv:RankErrorIconConverter x:Key="RankErrorIconConverter"/>
        <conv:RankVisibilityConverter x:Key="RankVisibilityConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Border x:Name="CardBorder" 
            Width="220" Height="320" 
            Margin="12"
            Background="{StaticResource SurfaceColor}"
            BorderBrush="{StaticResource BorderColor}"
            BorderThickness="1"
            CornerRadius="12"
            MouseEnter="CardBorder_MouseEnter"
            MouseLeave="CardBorder_MouseLeave"
            MouseLeftButtonDown="CardBorder_MouseLeftButtonDown">
        <Border.Effect>
            <DropShadowEffect Color="#00BFFF" BlurRadius="5" ShadowDepth="0" Opacity="0"/>
        </Border.Effect>
        
        <Border.RenderTransform>
            <ScaleTransform ScaleX="1" ScaleY="1"/>
        </Border.RenderTransform>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Name -->
            <TextBlock Grid.Row="0" Text="{Binding GameName}" 
                      FontSize="18" FontWeight="Bold" 
                      Foreground="{StaticResource TextPrimaryColor}" 
                      TextAlignment="Center" 
                      Margin="0,0,0,16"/>
            
            <!-- Rank Section -->
            <StackPanel Grid.Row="1" VerticalAlignment="Center">
                <!-- Nếu fetch rank thất bại: chỉ hiện Failed to load (chữ đỏ, không background, không icon) -->
                <TextBlock Text="Failed to load"
                           FontSize="14" FontWeight="SemiBold"
                           Foreground="#FF4444"
                           TextAlignment="Center"
                           Visibility="{Binding IsRankFailed, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <!-- Nếu Unranked/Unrated/Unknown: chỉ hiện chữ (không icon) -->
                <TextBlock Text="{Binding DisplayRank}"
                           FontSize="16" FontWeight="SemiBold"
                           Foreground="{StaticResource TextSecondaryColor}"
                           TextAlignment="Center"
                           Visibility="{Binding Path=., Converter={StaticResource RankVisibilityConverter}, ConverterParameter=UnrankedOnly}"/>
                <!-- Nếu có rank: hiện icon + tên rank (và không failed) -->
                <StackPanel Orientation="Vertical" Visibility="{Binding Path=., Converter={StaticResource RankVisibilityConverter}, ConverterParameter=RankedOnly}">
                    <Border Width="48" Height="48" CornerRadius="24" 
                            Background="{StaticResource BackgroundGradient}" 
                            Margin="0,0,0,8"
                            Visibility="Visible">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding DisplayRank, Converter={StaticResource RankToIconConverter}}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <Image Source="{Binding DisplayRank, Converter={StaticResource RankToIconConverter}}"
                               Stretch="UniformToFill" Margin="4"/>
                    </Border>
                    <TextBlock Text="{Binding DisplayRank}" 
                               FontSize="12" 
                               Foreground="{StaticResource TextSecondaryColor}" 
                               TextAlignment="Center"/>
                </StackPanel>
                
                <!-- Rank Rating -->
                <TextBlock Text="{Binding RankRating, StringFormat='{}{0} RR'}" 
                          FontSize="10" 
                          Foreground="{StaticResource TextSecondaryColor}" 
                          TextAlignment="Center"
                          Margin="0,4,0,0"
                          Visibility="{Binding IsRankLoaded, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>
            
            <!-- Action Buttons -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" 
                       HorizontalAlignment="Center" 
                       Margin="0,16,0,0">
                
                <!-- Login Button -->
                <Button x:Name="LoginButton"
                       Content="Login"
                       Style="{StaticResource ModernButton}"
                       Height="28" Padding="12,4"
                       Margin="0,0,8,0"
                       Click="LoginButton_Click"/>
                
                <!-- Refresh Rank Button -->
                <Button x:Name="RefreshButton"
                       Content="🔄"
                       Style="{StaticResource SecondaryButton}"
                       Width="28" Height="28"
                       ToolTip="Refresh rank"
                       Click="RefreshButton_Click"/>
            </StackPanel>
            
            <!-- Selection Indicator -->
            <Border x:Name="SelectionIndicator"
                   Grid.RowSpan="4"
                   BorderThickness="2"
                   BorderBrush="{StaticResource PrimaryColor}"
                   CornerRadius="12"
                   Visibility="Collapsed"/>
        </Grid>
    </Border>
</UserControl> 